function H(e){return"springs"in e}function J(e){return"css"in e&&typeof e.css=="function"}function K(e){return"tick"in e&&typeof e.tick=="function"}function Q(e){if(J(e)&&K(e))throw new Error("SingleSpringConfig cannot have both 'tick' and 'css' defined. Use one or the other.")}function Z(e){if(e.tick&&e.css)throw new Error("SpringItem cannot have both 'tick' and 'css' defined. Use one or the other.")}async function V(e){const t=await e;return H(t)?(t.springs.forEach(Z),t):(Q(t),{prepare:t.prepare,wait:t.wait,onStart:t.onStart,onEnd:t.onEnd,springs:[{spring:t.spring,tick:t.tick,css:t.css}],schedule:"parallel"})}function L(e,t){const n=e.schedule??"parallel",o=e.springs.map(r=>{let i;switch(n){case"parallel":i=0;break;case"sequential":i=1;break;case"stagger":i=Math.max(0,Math.min(1,r.offset??0));break;default:i=0}const{css:l,offset:u,...y}=r,m=l?typeof l=="function"?t?{element:t,style:l}:void 0:{element:l.element,style:l.style}:void 0;return{...y,css:m,normalizedOffset:i}}),{schedule:s,...a}=e;return{...a,springs:o}}var tt=Object.defineProperty,nt=(e,t,n)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,h=(e,t,n)=>nt(e,typeof t!="symbol"?t+"":t,n);class et{constructor(){h(this,"listeners",new Set),h(this,"rafId",null),h(this,"isRunning",!1),h(this,"startTime",Date.now()),h(this,"lastUpdate",this.startTime),h(this,"elapsed",0),h(this,"lagThreshold",500),h(this,"adjustedLag",33),h(this,"maxDeltaTime",33),h(this,"gap",1e3/240),h(this,"nextTime",this.gap),h(this,"tick",()=>{const t=Date.now();let n=t-this.lastUpdate;n>this.lagThreshold||n<0?(this.startTime+=n-this.adjustedLag,n=this.adjustedLag):n>this.maxDeltaTime&&(n=this.maxDeltaTime),this.lastUpdate=t;const o=t-this.startTime,s=o-this.nextTime;if(s>0){const a=n/1e3;this.elapsed=o/1e3,this.nextTime+=s+(s>=this.gap?4:this.gap-s),this.listeners.forEach(r=>{r(a,this.elapsed)})}this.listeners.size>0?this.rafId=requestAnimationFrame(this.tick):(this.isRunning=!1,this.rafId=null)})}subscribe(t){return this.listeners.add(t),this.isRunning||(this.isRunning=!0,this.rafId=requestAnimationFrame(this.tick)),()=>{this.unsubscribe(t)}}unsubscribe(t){this.listeners.delete(t),this.listeners.size===0&&this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.isRunning=!1,this.rafId=null)}lagSmoothing(t,n){this.lagThreshold=t,this.adjustedLag=Math.min(n,t)}fps(t){this.gap=1e3/t,this.nextTime=this.elapsed*1e3+this.gap}getListenerCount(){return this.listeners.size}getElapsed(){return this.elapsed}}const T=new et;function U(e){const t=e.stiffness,n=e.damping,o=1,s=Math.sqrt(t/o),a=n/(2*Math.sqrt(t*o));return{omega:s,zeta:a}}function j(e,t,n,o){const{omega:s,zeta:a}=n,{position:r,velocity:i}=e,l=Math.min(o,.033),u=-2*l*a*s*i,y=l*s*s*(t-r),m=i+u+y;return{position:r+l*m,velocity:m}}const ot=.01,it=.01,W=.05;function _(e,t){const n=Math.abs(t-e.position),o=Math.abs(e.velocity);return n<ot&&o<it}function st(e){const{from:t,to:n,spring:o,velocity:s=0,onUpdate:a,onComplete:r,onStart:i}=e;let l={position:t,velocity:s},u=!0,y=0,m=!1;const A=U(o),S=c=>{if(u){if(m||(m=!0,i?.()),l=j(l,n,A,c),_(l,n)){if(y+=Math.min(c,.033),y>=W){l={position:n,velocity:0},u=!1,a(l.position),T.unsubscribe(S),r();return}}else y=0;a(l.position)}};return T.subscribe(S),{stop:()=>{u&&(u=!1,T.unsubscribe(S))},getPosition:()=>l.position,getVelocity:()=>l.velocity,isRunning:()=>u}}const I=1e3/60;function rt(e,t,n,o=0){const s=U(n),a=600;let r={position:e,velocity:o},i=0;const l=[];for(let u=0;u<a;u++){const y=u*I;if(l.push({time:y,position:r.position,velocity:r.velocity}),r=j(r,t,s,I/1e3),_(r,t)){if(i+=I/1e3,i>=W){l.push({time:(u+1)*I,position:t,velocity:0});break}}else i=0}return l}function $(e,t){if(e.length===0)return{position:0,velocity:0};const n=e[0],o=e[e.length-1];if(t<=0)return{position:n.position,velocity:n.velocity};if(t>=o.time)return{position:o.position,velocity:o.velocity};let s=0,a=e.length-1;for(;s<a-1;){const u=Math.floor((s+a)/2);e[u].time<=t?s=u:a=u}const r=e[s],i=e[a],l=(t-r.time)/(i.time-r.time);return{position:r.position+(i.position-r.position)*l,velocity:r.velocity+(i.velocity-r.velocity)*l}}function at(e,t){return e.map(n=>t(n.position))}function lt(e){const{element:t,from:n,to:o,spring:s,velocity:a=0,style:r,onComplete:i,onStart:l}=e,u=rt(n,o,s,a);if(u.length===0)return l?.(),i(),{stop:()=>{},getPosition:()=>o,getVelocity:()=>0,isRunning:()=>!1};const y=at(u,r),m=u[u.length-1],A=m.time,S=t.animate(y,{duration:A,fill:"forwards",easing:"linear"});let c=!0;const p=performance.now();return l?.(),S.onfinish=()=>{c&&(c=!1,i())},{stop:()=>{c&&(c=!1,S.cancel())},getPosition:()=>{if(!c)return m.position;const w=performance.now()-p;return $(u,w).position},getVelocity:()=>{if(!c)return 0;const w=performance.now()-p;return $(u,w).velocity},isRunning:()=>c}}function ct(e){const{from:t,to:n,spring:o,velocity:s,onComplete:a,onStart:r,tick:i,css:l}=e;if(i&&l)throw new Error("Cannot use both 'tick' and 'css' options together");return!i&&!l?(r?.(),a(),{stop:()=>{},getPosition:()=>n,getVelocity:()=>0,isRunning:()=>!1}):l?lt({element:l.element,from:t,to:n,spring:o,velocity:s,style:l.style,onComplete:a,onStart:r}):st({from:t,to:n,spring:o,velocity:s,onUpdate:i,onComplete:a,onStart:r})}class X{}class x extends X{constructor(t){if(super(),h(this,"options"),h(this,"controls",null),h(this,"isAnimating",!1),h(this,"currentValue"),h(this,"currentVelocity",0),t.tick&&t.css)throw new Error("Cannot use both 'tick' and 'css' options together");this.options={from:t.from??0,to:t.to??1,spring:t.spring??{stiffness:300,damping:30},tick:t.tick,css:t.css,onComplete:t.onComplete??(()=>{}),onStart:t.onStart},this.currentValue=this.options.from}runAnimation(t){this.isAnimating=!0,this.controls=ct({from:this.currentValue,to:t,spring:this.options.spring,velocity:this.currentVelocity,tick:this.options.tick,css:this.options.css,onStart:this.options.onStart,onComplete:()=>{this.currentValue=t,this.currentVelocity=0,this.isAnimating=!1,this.controls=null,this.options.onComplete()}})}forward(){this.stop(),this.runAnimation(this.options.to)}backward(){this.stop(),this.runAnimation(this.options.from)}reverse(){const t=this.options.from;this.options.from=this.options.to,this.options.to=t,this.isAnimating&&(this.stop(),this.runAnimation(this.options.to))}stop(){this.controls&&(this.currentValue=this.controls.getPosition(),this.currentVelocity=this.controls.getVelocity(),this.controls.stop(),this.controls=null),this.isAnimating=!1}getVelocity(){var t;return((t=this.controls)==null?void 0:t.getVelocity())??this.currentVelocity}getCurrentValue(){var t;return((t=this.controls)==null?void 0:t.getPosition())??this.currentValue}getIsAnimating(){return this.isAnimating}getCurrentState(){return{position:this.getCurrentValue(),velocity:this.getVelocity(),from:this.options.from,to:this.options.to}}setValue(t){this.currentValue=t}setVelocity(t){this.currentVelocity=t}updateOptions(t){this.options={...this.options,...t}}static fromState(t,n){const o=new x(n);return o.setValue(t.position),o.setVelocity(t.velocity),o}}class M extends X{constructor(t){super(),h(this,"config"),h(this,"animators",new Map),h(this,"springOrder",[]),h(this,"completedCount",0),h(this,"completedAnimators",new Set),h(this,"direction","forward"),h(this,"idCounter",0),h(this,"rafId",null),h(this,"from"),h(this,"to"),this.config=t.config,this.from=t.from,this.to=t.to,this.initializeAnimators()}generateId(){return`spring_${this.idCounter++}`}initializeAnimators(){this.config.springs.forEach(t=>{const n=this.generateId(),o=new x({from:this.from,to:this.to,spring:t.spring,tick:t.tick,css:t.css,onComplete:()=>this.onAnimatorComplete(n),onStart:t.onStart});this.animators.set(n,{id:n,item:t,animator:o,started:!1}),this.springOrder.push(n)})}getAnimatorProgress(t){const n=t.animator.getCurrentState(),o=Math.abs(n.to-n.from);return o===0?1:Math.abs(n.position-n.from)/o}getOrderedIds(){return this.direction==="forward"?this.springOrder:[...this.springOrder].reverse()}onAnimatorComplete(t){var n,o,s,a,r,i;const l=this.animators.get(t);!l||this.completedAnimators.has(t)||(this.completedAnimators.add(t),this.completedCount++,(o=(n=l.item).onComplete)==null||o.call(n),(a=(s=this.config).onProgress)==null||a.call(s,this.completedCount,this.config.springs.length),this.completedCount===this.config.springs.length&&(this.stopScheduler(),(i=(r=this.config).onEnd)==null||i.call(r)))}checkAndStartSprings(){const t=this.getOrderedIds();for(let n=0;n<t.length;n++){const o=t[n],s=this.animators.get(o);if(!s||s.started)continue;if(n===0){this.startAnimator(o);continue}const a=t[n-1],r=this.animators.get(a);if(!r||!r.started)continue;const i=this.getAnimatorProgress(r),l=s.item.normalizedOffset;i>=l&&this.startAnimator(o)}}startAnimator(t){const n=this.animators.get(t);!n||n.started||(n.started=!0,this.direction==="forward"?n.animator.forward():n.animator.backward())}startScheduler(){const t=()=>{this.checkAndStartSprings(),this.getIsAnimating()&&(this.rafId=requestAnimationFrame(t))};t()}stopScheduler(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null)}getFirstAnimator(){var t;const n=this.springOrder[0];return n?((t=this.animators.get(n))==null?void 0:t.animator)??null:null}forward(){var t,n;this.stop(),this.direction="forward",this.completedCount=0,this.completedAnimators.clear(),this.resetStartedFlags(),(n=(t=this.config).onStart)==null||n.call(t),this.startScheduler()}backward(){var t,n;this.stop(),this.direction="backward",this.completedCount=0,this.completedAnimators.clear(),this.resetStartedFlags(),(n=(t=this.config).onStart)==null||n.call(t),this.startScheduler()}resetStartedFlags(){this.animators.forEach(t=>{t.started=!1})}stop(){this.stopScheduler(),this.animators.forEach(t=>{t.animator.stop(),t.started=!1})}reverse(){this.direction=this.direction==="forward"?"backward":"forward",this.animators.forEach(t=>{if(!t.started)return;const n=t.animator.getCurrentState();if(n.position===n.to){const o=x.fromState({position:this.to,velocity:0},{from:this.to,to:this.from,spring:t.item.spring,tick:t.item.tick,css:t.item.css,onComplete:()=>this.onAnimatorComplete(t.id),onStart:t.item.onStart});o.forward(),t.animator=o}else t.animator.reverse()})}getCurrentState(){const t=this.getFirstAnimator();return t?t.getCurrentState():{position:0,velocity:0,from:0,to:1}}getCurrentValue(){const t=this.getFirstAnimator();return t?.getCurrentValue()??0}getVelocity(){const t=this.getFirstAnimator();return t?.getVelocity()??0}setValue(t){const n=this.getFirstAnimator();n?.setValue(t)}setVelocity(t){const n=this.getFirstAnimator();n?.setVelocity(t)}getIsAnimating(){for(const t of this.animators.values())if(t.animator.getIsAnimating())return!0;return!1}static fromState(t,n){const o=new M(n);return o.setValue(t.position),o.setVelocity(t.velocity),o}}const Y=Symbol.for("TRANSITION_STRATEGY"),ut=e=>({runIn:async t=>{const{currentAnimation:n}=e;if(n&&n.direction==="out"){const o=n.controller.getCurrentValue(),s=n.controller.getVelocity();if(n.controller.stop(),t.out)return{config:await t.out,state:{position:o,velocity:s},from:1,to:0,direction:"backward"}}return t.in?{config:await t.in,state:{position:0,velocity:0},from:0,to:1,direction:"forward"}:{state:{position:0,velocity:0},from:0,to:1,direction:"forward"}},runOut:async t=>{const{currentAnimation:n}=e;if(n&&n.direction==="in"){const o=n.controller.getCurrentValue(),s=n.controller.getVelocity();if(n.controller.stop(),t.in)return{config:await t.in,state:{position:o,velocity:s},from:0,to:1,direction:"backward"}}return t.out?{config:await t.out,state:{position:1,velocity:0},from:1,to:0,direction:"forward"}:{state:{position:1,velocity:0},from:1,to:0,direction:"forward"}}}),ft=()=>({runIn:async e=>e.in?{config:await e.in,state:{position:0,velocity:0},from:0,to:1,direction:"forward"}:{state:{position:0,velocity:0},from:0,to:1,direction:"forward"},runOut:async e=>e.out?{config:await e.out,state:{position:1,velocity:0},from:1,to:0,direction:"forward"}:{state:{position:1,velocity:0},from:1,to:0,direction:"forward"}}),N="data-ssgoi-scope",B="data-ssgoi-scope-ready";function Et(){return e=>{if(e)return e.setAttribute(N,""),queueMicrotask(()=>{queueMicrotask(()=>{e.setAttribute(B,"true")})}),()=>{}}}function ht(e){return e.hasAttribute(B)}function dt(e){return e.closest(`[${N}]`)}function mt(e,t){var n;let o=null,s=null,a=null,r=null;const i={get currentAnimation(){return o}},l=((n=t?.strategy)==null?void 0:n.call(t,i))||ut(i),u=async c=>{var p;s&&(s.remove(),s=null);const w=e(),k=w.in&&w.in(c),d=!(t!=null&&t.strategy)&&w.out?w.out(c):void 0;if(!k)return;const g={in:V(k),out:d?V(d):void 0},f=await l.runIn(g);if(!f.config){o&&(o.direction="in");return}const v=f.config;(p=v.prepare)==null||p.call(v,c),v.wait&&await v.wait();const E=L({...v,onEnd:()=>{var C;o=null,(C=v.onEnd)==null||C.call(v)}},c),b=M.fromState(f.state,{config:E,from:f.from,to:f.to});o={controller:b,direction:"in"},f.direction==="forward"?b.forward():b.backward()},y=async c=>{var p;s=c;const w=e(),k=!(t!=null&&t.strategy)&&w.in?w.in(c):void 0,d=w.out&&w.out(c);if(!d)return;const g={in:k?V(k):void 0,out:V(d)},f=await l.runOut(g);if(!f.config){o&&(o.direction="out"),s&&(s.remove(),s=null);return}const v=f.config;(p=v.prepare)==null||p.call(v,c),C(),v.wait&&await v.wait();const E=L({...v,onEnd:()=>{var F,z;(F=v.onEnd)==null||F.call(v),s&&(s.remove(),s=null),o=null,(z=t?.onCleanupEnd)==null||z.call(t)}},c),b=M.fromState(f.state,{config:E,from:f.from,to:f.to});o={controller:b,direction:"out"},f.direction==="forward"?b.forward():b.backward();function C(){!a||!s||(r&&a.contains(r)?a.insertBefore(s,r):a.appendChild(s))}};let m=null,A=!1;const S=c=>()=>{if(A)return;A=!0;const p=c.cloneNode(!0);m?queueMicrotask(()=>{document.contains(m)&&y(p)}):y(p)};return c=>{if(c)return a=c.parentElement,r=c.nextElementSibling,A=!1,t?.scope==="local"?queueMicrotask(()=>{m=dt(c),!(m&&!ht(m))&&u(c)}):u(c),S(c)}}const pt=3,gt=e=>{if(!e)return null;const t=e.split(`
`).map(n=>n.trim());for(let n=pt;n<Math.min(t.length,6);n++){const o=t[n],s=o?.match(/\(?([^):]+):(\d+):(\d+)\)?$/);if(!s)continue;const a=s[1]??"",r=s[2]??"0",i=s[3]??"0";return{file:a.split(/[\\/]/).pop()||a,line:r,column:i}}return null},R=new Map,O=new Map;function yt(e,t,n){R.set(e,t);let o=O.get(e);if(o)return o;const s=t;return o=mt(()=>R.get(e)||(console.warn(`Transition "${String(e)}" not found`),{}),{strategy:n?.strategy,scope:n?.scope,onCleanupEnd:()=>{R.get(e)===s&&G(e)}}),O.set(e,o),o}function G(e){R.delete(e),O.delete(e)}function vt(){const e=gt(new Error().stack);return e?`auto_${e.file}_${e.line}_${e.column}`:Symbol(`ssgoi_auto_${Date.now()}`)}const q=globalThis.FinalizationRegistry,D=q?new q(e=>{try{G(e)}catch{}}):void 0;function Vt(e){const t=e.key??vt();if(e.ref&&D)try{D.register(e.ref,t)}catch{}return yt(t,{in:e.in,out:e.out},{strategy:e[Y],scope:e.scope})}function wt(e){const t=e.filter(n=>n.symmetric).map(n=>({from:n.to,to:n.from,transition:n.transition}));return[...e,...t]}function St(e){let t=!1,n=0,o=0,s=!1;const a=50,r=S=>{if(!e)return;const c=S.touches[0];c&&(s=c.clientX<a,s&&(n=c.clientX,o=c.clientY))},i=S=>{if(!e||!s)return;const c=S.touches[0];if(!c)return;const p=c.clientX-n,w=c.clientY-o;p>window.outerWidth/2-5&&Math.abs(p)>Math.abs(w)?t=!0:t=!1},l=()=>{e&&(s=!1,n=0,o=0)},u=()=>t,y=()=>{typeof window>"u"||e&&(window.addEventListener("touchstart",r,{passive:!0}),window.addEventListener("touchmove",i,{passive:!0}),window.addEventListener("touchend",l,{passive:!0}))},m=()=>{typeof window>"u"||(window.removeEventListener("touchstart",r),window.removeEventListener("touchmove",i),window.removeEventListener("touchend",l))};let A=0;return{initialize:y,cleanup:m,isSwipePending:u,resetSwipeDetection:()=>{A++,A>1&&(A=0,t=!1)}}}const At=e=>{let t=e.parentElement;for(;t&&t!==document.body;){const n=window.getComputedStyle(t),o=n.overflow+n.overflowY+n.overflowX;if(o.includes("auto")||o.includes("scroll")||t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)return t;t=t.parentElement}return document.documentElement},bt=e=>{let t=e.parentElement;for(;t&&t!==document.body;){const n=window.getComputedStyle(t).position;if(n==="relative"||n==="absolute"||n==="fixed"||n==="sticky")return t;t=t.parentElement}return document.body};function kt(){let e=null,t=null;const n=new Map;let o=null;const s=()=>{e&&o&&n.set(o,{x:e.scrollLeft,y:e.scrollTop})};return{initializeContext:(a,r)=>{t=a,e||(e=At(a),(e===document.documentElement?window:e).addEventListener("scroll",s,{passive:!0})),o=r},calculateScrollOffset:(a,r)=>{const i=a&&n.has(a)?n.get(a):{x:0,y:0},l=r&&n.has(r)?n.get(r):{x:0,y:0};return{x:-l.x+i.x,y:-l.y+i.y}},getScrollContainer:()=>e,getPositionedParentElement:()=>t?bt(t):document.body,getScrollPosition:a=>a&&n.has(a)?n.get(a):{x:0,y:0}}}function P(e,t){if(t==="*")return!0;if(t.endsWith("/*")){const n=t.slice(0,-2);return e===n||e.startsWith(n+"/")}return e===t}function Ct(e,t,n){for(const o of n)if(P(e,o.from)&&P(t,o.to))return o.transition;for(const o of n)if((o.from==="*"||P(e,o.from))&&(o.to==="*"||P(t,o.to)))return o.transition;return null}function It(e,t){const{transitions:n=[],defaultTransition:o,middleware:s=(d,g)=>({from:d,to:g}),skipOnIosSwipe:a=!0}=e,{outFirst:r=!0}=t||{};let i=null;const l=wt(n),{initializeContext:u,calculateScrollOffset:y,getScrollContainer:m,getPositionedParentElement:A,getScrollPosition:S}=kt(),c=St(a);c.initialize();function p(){if(i!=null&&i.from&&i!=null&&i.to){const{from:d,to:g}=s(i.from,i.to),f=Ct(d,g,l)||o,v=y(i.from,i.to),E={scrollOffset:v,scroll:S(i.from),get scrollingElement(){return m()||document.documentElement},get positionedParent(){return A()}},b={scrollOffset:v,get scroll(){return i?S(i.to):{x:0,y:0}},get scrollingElement(){return m()||document.documentElement},get positionedParent(){return A()}};f&&(f.out&&i.outResolve&&i.outResolve(C=>f.out(C,E)),f.in&&i.inResolve&&i.inResolve(C=>f.in(C,b))),i=null}}function w(){i&&(i.inResolve&&i.inResolve(()=>({})),i.outResolve&&i.outResolve(()=>({})),i=null)}const k=r?async(d,g)=>c.isSwipePending()?(c.resetSwipeDetection(),()=>({})):g==="in"&&(!i||!i.from)?()=>({}):(i||(i={}),g==="out"?(i.from=d,new Promise(f=>{i.outResolve=f,p()})):(i.to=d,new Promise(f=>{i.inResolve=f,p()}))):async(d,g)=>c.isSwipePending()?(c.resetSwipeDetection(),()=>({})):(i&&(g==="out"&&i.from&&i.from!==d||g==="in"&&i.to&&i.to!==d)&&w(),i||(i={}),g==="out"?(i.from=d,new Promise(f=>{i.outResolve=f,p()})):(i.to=d,new Promise(f=>{i.inResolve=f,p()})));return d=>({key:d,in:async g=>(u(g,d),(await k(d,"in"))(g)),out:async g=>(await k(d,"out"))(g),[Y]:ft})}export{It as D,Vt as I,Et as P};
