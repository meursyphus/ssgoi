# SSGOI - Page Transition Library

> Universal page transition library for web applications. Works in all modern browsers (Chrome, Firefox, Safari), unlike browser's View Transition API (Chrome-only).

## Installation (React/Next.js)

```bash
npm install @ssgoi/react
```

Other frameworks:
- Svelte: `npm install @ssgoi/svelte`
- Vue: `npm install @ssgoi/vue`
- Angular: `npm install @ssgoi/angular`

## Quick Start (React/Next.js)

### 1. Layout Setup

```tsx
// app/layout.tsx
import { Ssgoi } from "@ssgoi/react";
import { fade } from "@ssgoi/react/view-transitions";

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html>
      <body>
        <Ssgoi config={{ defaultTransition: fade() }}>
          {/* IMPORTANT: position: relative and z-index: 0 required */}
          <div style={{ position: "relative", zIndex: 0, minHeight: "100vh" }}>
            {children}
          </div>
        </Ssgoi>
      </body>
    </html>
  );
}
```

**Why `position: relative` is required:**
- During OUT animation, the leaving page becomes `position: absolute`
- Without a positioned parent, the page will jump to wrong position
- `z-index: 0` creates a stacking context to prevent z-index conflicts

### 2. Page Setup

Each page must be wrapped with `SsgoiTransition`:

```tsx
// app/page.tsx
import { SsgoiTransition } from "@ssgoi/react";

export default function HomePage() {
  return (
    <SsgoiTransition id="/">
      <main>
        <h1>Home</h1>
      </main>
    </SsgoiTransition>
  );
}

// app/about/page.tsx
export default function AboutPage() {
  return (
    <SsgoiTransition id="/about">
      <main>
        <h1>About</h1>
      </main>
    </SsgoiTransition>
  );
}
```

**Important:** The `id` prop should match the route path for proper transition matching.

## Route-based Transitions

Define different transitions for different route pairs:

```tsx
import { Ssgoi } from "@ssgoi/react";
import { fade, scroll, drill, hero } from "@ssgoi/react/view-transitions";

const config = {
  defaultTransition: fade(),
  transitions: [
    // Scroll up when going home -> about
    { from: "/", to: "/about", transition: scroll({ direction: "up" }) },
    // Scroll down when going about -> home
    { from: "/about", to: "/", transition: scroll({ direction: "down" }) },

    // Drill into detail pages (wildcard pattern)
    { from: "/products", to: "/products/*", transition: drill({ direction: "enter" }) },
    { from: "/products/*", to: "/products", transition: drill({ direction: "exit" }) },

    // Symmetric: auto-creates reverse transition
    { from: "/blog", to: "/blog/*", transition: fade(), symmetric: true },
  ],
};

<Ssgoi config={config}>
  <div style={{ position: "relative", zIndex: 0, minHeight: "100vh" }}>
    {children}
  </div>
</Ssgoi>
```

### Route Pattern Matching

1. **Exact match**: `/home` matches only `/home`
2. **Wildcard suffix**: `/products/*` matches `/products/123`, `/products/abc`
3. **Global wildcard**: `*` matches any route

Priority: Exact > Wildcard > Default

## Built-in View Transitions (Page-level)

```tsx
import { fade, scroll, drill, hero, pinterest } from "@ssgoi/react/view-transitions";

// Fade - smooth opacity transition
fade()

// Scroll - vertical scrolling
scroll({ direction: "up" })   // or "down"

// Drill - iOS-style drill in/out
drill({ direction: "enter" }) // or "exit"

// Hero - shared element animation (requires data-hero-key)
hero()

// Pinterest - expanding card effect
pinterest()
```

## Element Transitions (Component-level)

Animate individual elements on mount/unmount:

```tsx
import { transition } from "@ssgoi/react";
import { fade, scale, slide, blur, rotate, bounce } from "@ssgoi/react/transitions";

function Card({ show }) {
  return show && (
    <div ref={transition({
      key: "my-card",
      ...fade()
    })}>
      Card content
    </div>
  );
}

// With custom options
<div ref={transition({
  key: "custom",
  ...scale({ start: 0.8, opacity: 0 })
})}>
  Content
</div>

// Available presets
fade({ from: 0, to: 1 })
scale({ start: 0, opacity: 0, axis: "both" | "x" | "y" })
slide({ direction: "left" | "right" | "up" | "down", distance: 100 })
blur({ amount: 10, scale: false, fade: true })
rotate({ degrees: 180 })
bounce()
```

## Custom Transitions

Create custom transitions using `css` (recommended) or `tick`:

```tsx
// Using css (Web Animation API - better performance)
<div ref={transition({
  key: "custom",
  in: () => ({
    physics: { spring: { stiffness: 300, damping: 30 } },
    css: (progress) => ({
      opacity: progress,
      transform: `translateY(${(1 - progress) * 20}px)`,
    }),
  }),
  out: () => ({
    physics: { spring: { stiffness: 300, damping: 30 } },
    css: (progress) => ({
      opacity: progress,
      transform: `translateY(${(1 - progress) * 20}px)`,
    }),
  }),
})}>
  Content
</div>

// Using tick (RAF-based - for complex DOM manipulation)
<div ref={transition({
  key: "tick-example",
  in: (element) => ({
    physics: { spring: { stiffness: 300, damping: 30 } },
    tick: (progress) => {
      element.style.opacity = String(progress);
      element.style.transform = `scale(${0.8 + progress * 0.2})`;
    },
  }),
})}>
  Content
</div>
```

**css vs tick:**
- `css`: Pre-computes spring physics to keyframes, runs on GPU, main thread free
- `tick`: RAF-based, useful when you need dynamic DOM manipulation during animation
- Cannot use both simultaneously

## TransitionScope

Control animation behavior for grouped elements:

```tsx
import { TransitionScope, transition } from "@ssgoi/react";
import { fade } from "@ssgoi/react/transitions";

function Modal({ show }) {
  return show && (
    <TransitionScope>
      <div className="modal">
        {/* scope: 'local' - skips animation when mounting/unmounting with parent */}
        <div ref={transition({ ...fade(), scope: "local" })}>
          Won't animate when modal opens/closes
        </div>

        {/* scope: 'global' (default) - always animates */}
        <div ref={transition({ ...fade() })}>
          Always animates
        </div>
      </div>
    </TransitionScope>
  );
}
```

Use cases:
- Page transitions where child elements shouldn't animate individually
- Modal content that appears with the container
- Lists that mount/unmount as a group

## Physics Options

SSGOI supports multiple physics engines for animations:

### Spring Physics (ease-out)

Default physics engine with natural spring-based motion:

```tsx
<div ref={transition({
  key: "spring",
  in: () => ({
    physics: {
      spring: {
        stiffness: 300,
        damping: 30,
        doubleSpring: true  // Optional: creates ease-in-out effect
      }
    },
    css: (progress) => ({ opacity: progress }),
  }),
})}>
  Content
</div>
```

- `stiffness`: How quickly the spring responds (higher = faster)
- `damping`: Resistance to motion (higher = less bouncy)
- `doubleSpring`: Combines two springs for smooth ease-in-out effect

### Inertia Physics (ease-in)

Decelerating motion that starts fast and slows down:

```tsx
<div ref={transition({
  key: "inertia",
  in: () => ({
    physics: {
      inertia: {
        acceleration: 20,
        resistance: 1.5,
        resistanceType: 'quadratic'  // 'linear' | 'quadratic'
      }
    },
    css: (progress) => ({ opacity: progress }),
  }),
})}>
  Content
</div>
```

- `acceleration`: Initial velocity (higher = faster start)
- `resistance`: How quickly it decelerates (higher = slower)
- `resistanceType`: Deceleration curve (`linear` for constant, `quadratic` for exponential)

### Custom Integrator

Create your own physics engine:

```tsx
import type { Integrator } from '@ssgoi/core';

class MyCustomIntegrator implements Integrator {
  integrate(state, deltaTime) {
    // Custom physics calculation
    return {
      position: state.position + velocity * deltaTime,
      velocity: state.velocity,
      done: state.position >= 1,
    };
  }

  fromState(state) {
    return new MyCustomIntegrator();
  }
}

<div ref={transition({
  key: "custom-physics",
  in: () => ({
    physics: {
      integrator: () => new MyCustomIntegrator()
    },
    css: (progress) => ({ opacity: progress }),
  }),
})}>
  Content
</div>
```

## Hero Transitions

Shared element animations between pages:

```tsx
// Page 1 - List
<Link href="/item/1">
  <div data-hero-key="item-1">
    <img src="..." />
  </div>
</Link>

// Page 2 - Detail
<div data-hero-key="item-1">
  <img src="..." />  {/* Same hero-key, element morphs */}
</div>
```

Config:
```tsx
const config = {
  transitions: [
    { from: "/list", to: "/item/*", transition: hero() },
  ],
};
```

## Performance

SSGOI achieves 60fps through:
- **Web Animation API**: Physics engines (Spring, Inertia) pre-computed to keyframes
- **GPU acceleration**: Uses transform/opacity for hardware rendering
- **Off main thread**: Animations run on compositor thread
- **State memory**: Animation positions preserved across navigation (back/forward)

## Common Pitfalls

1. **Missing `position: relative`** on Ssgoi container
   - OUT animation uses `position: absolute`
   - Without positioned parent, page jumps incorrectly

2. **Missing `SsgoiTransition` wrapper**
   - Each page must be wrapped
   - `id` should match route path

3. **Z-index issues**
   - Add `zIndex: 0` to create stacking context
   - Prevents child elements from overlapping incorrectly during transitions

4. **Dynamic routes**
   - Use wildcard patterns: `/products/*`
   - Or dynamic id: `<SsgoiTransition id={`/products/${id}`}>`

## Links

- Documentation: https://ssgoi.dev
- GitHub: https://github.com/meursyphus/ssgoi
- NPM: @ssgoi/react, @ssgoi/svelte, @ssgoi/vue, @ssgoi/angular
