---
title: "页面过渡"
description: "基于路由的页面过渡系统"
nav-title: "页面过渡"
---

## 配置接口

### SsgoiConfig

```typescript
interface SsgoiConfig {
  transitions: Array<{
    from: string; // 源路由模式
    to: string; // 目标路由模式
    transition: SggoiTransition;
    symmetric?: boolean; // 自动生成双向过渡
  }>;
  defaultTransition?: SggoiTransition;
}
```

### 基本配置

<Tabs items={[{ label: "React", value: "react" }, { label: "Svelte", value: "svelte" }, { label: "Angular", value: "angular" }]}>
  <TabPanel value="react">
    ```tsx
    import { Ssgoi } from "@ssgoi/react";
    import { fade, scroll, drill } from "@ssgoi/react/view-transitions";

    const config = {
      defaultTransition: fade(), // 默认过渡
      transitions: [
        {
          from: "/",
          to: "/about",
          transition: scroll({ direction: "up" }),
        },
        {
          from: "/about",
          to: "/",
          transition: scroll({ direction: "down" }),
        },
      ],
    };

    export default function Layout({ children }) {
      return (
        <Ssgoi config={config}>
          <div style={{ position: "relative", minHeight: "100vh" }}>
            {children}
          </div>
        </Ssgoi>
      );
    }
    ```
  </TabPanel>
  <TabPanel value="svelte">
    ```svelte
    <script>
      import { Ssgoi } from "@ssgoi/svelte";
      import { fade, scroll, drill } from "@ssgoi/svelte/view-transitions";

      const config = {
        defaultTransition: fade(), // 默认过渡
        transitions: [
          {
            from: "/",
            to: "/about",
            transition: scroll({ direction: "up" }),
          },
          {
            from: "/about",
            to: "/",
            transition: scroll({ direction: "down" }),
          },
        ],
      };
    </script>

    <Ssgoi {config}>
      <div style="position: relative; min-height: 100vh;">
        <slot />
      </div>
    </Ssgoi>
    ```
  </TabPanel>
  <TabPanel value="angular">
    ```typescript
    import { Component } from "@angular/core";
    import { Ssgoi } from "@ssgoi/angular";
    import { fade, scroll } from "@ssgoi/angular/view-transitions";
    import type { SsgoiConfig } from "@ssgoi/angular";

    @Component({
      selector: "app-root",
      standalone: true,
      imports: [Ssgoi],
      template: `
        <div
          ssgoi
          [config]="ssgoiConfig"
          style="position: relative; min-height: 100vh;"
        >
          <router-outlet />
        </div>
      `
    })
    export class AppComponent {
      ssgoiConfig: SsgoiConfig = {
        defaultTransition: fade(), // 默认过渡
        transitions: [
          {
            from: '/',
            to: '/about',
            transition: scroll({ direction: 'up' })
          },
          {
            from: '/about',
            to: '/',
            transition: scroll({ direction: 'down' })
          }
        ]
      };
    }
    ```
  </TabPanel>
</Tabs>

## 路由匹配规则

### 模式类型

1. **精确匹配**: `/home` → 与`/home`完全匹配
2. **通配符后缀**: `/products/*` → 匹配`/products/123`
3. **完全通配符**: `*` → 匹配所有路由

### 匹配优先级

更具体的模式优先：

```javascript
transitions: [
  // 第1优先级：精确匹配
  { from: "/blog/post-1", to: "/blog/post-2", transition: scroll() },

  // 第2优先级：通配符匹配
  { from: "/blog/*", to: "/blog/*", transition: fade() },

  // 第3优先级：defaultTransition
];
```

## 对称选项

自动生成双向过渡：

```javascript
{
  from: '/home',
  to: '/about',
  transition: fade(),
  symmetric: true  // 自动生成反向过渡
}

// 上述配置如下工作：
// /home → /about: fade
// /about → /home: fade (自动生成)
```

## 视图过渡结构

视图过渡遵循与元素过渡相同的结构：

```typescript
interface ViewTransition {
  in?: (
    element: HTMLElement,
    context?: SggoiTransitionContext
  ) => TransitionConfig;
  out?: (
    element: HTMLElement,
    context?: SggoiTransitionContext
  ) => TransitionConfig;
}
```

- **out**: 应用于from页面（退出页面）
- **in**: 应用于to页面（进入页面）

## 上下文对象

前一页和当前页之间的滚动差异作为第二个参数传递给视图过渡：

```typescript
interface SggoiTransitionContext {
  scrollOffset: {
    x: number; // 前一页和当前页之间的X轴滚动差
    y: number; // 前一页和当前页之间的Y轴滚动差
  };
}

// 示例：感知滚动的过渡
const scrollAwareTransition = {
  in: (element, context) => {
    const { scrollOffset } = context;
    return {
      prepare: (el) => {
        // 从滚动差异位置开始
        el.style.transform = `translateY(${-scrollOffset.y}px)`;
      },
      tick: (progress) => ({
        // 返回到原始位置
        transform: `translateY(${-scrollOffset.y * (1 - progress)}px)`,
      }),
    };
  },
};
```

## SsgoiTransition 包装器

包装每个页面的包装器组件（在 Angular 中为指令）：

<Tabs items={[{ label: "React", value: "react" }, { label: "Svelte", value: "svelte" }, { label: "Angular", value: "angular" }]}>
  <TabPanel value="react">
    ```tsx
    import { SsgoiTransition } from "@ssgoi/react";

    export default function Page() {
      return (
        <SsgoiTransition id="/page-path">
          <PageContent />
        </SsgoiTransition>
      );
    }
    ```
  </TabPanel>
  <TabPanel value="svelte">
    ```svelte
    <script>
      import { SsgoiTransition } from "@ssgoi/svelte";
    </script>

    <SsgoiTransition id="/page-path">
      <PageContent />
    </SsgoiTransition>
    ```
  </TabPanel>
  <TabPanel value="angular">
    ```typescript
    import { Component } from "@angular/core";
    import { SsgoiTransition } from "@ssgoi/angular";

    @Component({
      selector: "app-page",
      standalone: true,
      imports: [SsgoiTransition],
      template: `
        <section [ssgoiTransition]="'/page-path'">
          <app-page-content />
        </section>
      `
    })
    export class PageComponent {}
    ```
  </TabPanel>
</Tabs>

- `ssgoiTransition`: 用于路由匹配的标识符
- 该值会与配置中的from/to模式进行匹配

## 操作流程

1. **路由变更检测**: 路由器变更路由
2. **模式匹配**: 使用from/to模式查找要应用的过渡
3. **Out动画**: 对当前页面应用out过渡
4. **同步**: 等待out和in动画准备
5. **In动画**: 对新页面应用in过渡
6. **完成**: 两个动画都完成后清理

## 实用示例

### 分层导航

<Tabs items={[{ label: "React", value: "react" }, { label: "Svelte", value: "svelte" }, { label: "Angular", value: "angular" }]}>
  <TabPanel value="react">
    ```javascript
    const config = {
      transitions: [
        // 列表 → 详情
        {
          from: "/products",
          to: "/products/*",
          transition: drill({ direction: 'enter' }),
          symmetric: true, // 也自动处理详情 → 列表
        },

        // 标签导航
        { from: "/tab1", to: "/tab2", transition: scroll({ direction: "up" }) },
        { from: "/tab2", to: "/tab3", transition: scroll({ direction: "up" }) },
        { from: "/tab3", to: "/tab2", transition: scroll({ direction: "down" }) },
        { from: "/tab2", to: "/tab1", transition: scroll({ direction: "down" }) },
      ],
    };
    ```
  </TabPanel>
  <TabPanel value="svelte">
    ```svelte
    <script>
      import { drill, scroll } from "@ssgoi/svelte/view-transitions";

      const config = {
        transitions: [
          // 列表 → 详情
          {
            from: "/products",
            to: "/products/*",
            transition: drill({ direction: 'enter' }),
            symmetric: true, // 也自动处理详情 → 列表
          },

          // 标签导航
          { from: "/tab1", to: "/tab2", transition: scroll({ direction: "up" }) },
          { from: "/tab2", to: "/tab3", transition: scroll({ direction: "up" }) },
          { from: "/tab3", to: "/tab2", transition: scroll({ direction: "down" }) },
          { from: "/tab2", to: "/tab1", transition: scroll({ direction: "down" }) },
        ],
      };
    </script>
    ```
  </TabPanel>
  <TabPanel value="angular">
    ```typescript
    import { drill, scroll } from '@ssgoi/angular/view-transitions';
    import type { SsgoiConfig } from '@ssgoi/angular';

    const ssgoiConfig: SsgoiConfig = {
      transitions: [
        // 列表 → 详情
        {
          from: '/products',
          to: '/products/*',
          transition: drill({ direction: 'enter' }),
          symmetric: true // 也自动处理详情 → 列表
        },

        // 标签导航
        { from: '/tab1', to: '/tab2', transition: scroll({ direction: 'up' }) },
        { from: '/tab2', to: '/tab3', transition: scroll({ direction: 'up' }) },
        { from: '/tab3', to: '/tab2', transition: scroll({ direction: 'down' }) },
        { from: '/tab2', to: '/tab1', transition: scroll({ direction: 'down' }) }
      ]
    };
    ```
  </TabPanel>
</Tabs>
